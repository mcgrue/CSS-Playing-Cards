<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
 * Example HTML for CSS Playing Cards
 *
 * @author   Anika Henke <anika@selfthinker.org>
 * @license  CC BY-SA [http://creativecommons.org/licenses/by-sa/3.0]
 * @version  2011-06-14
 * @link     http://selfthinker.github.com/CSS-Playing-Cards/
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>CSS Playing Cards</title>
    <link rel="stylesheet" type="text/css" href="cards.css" media="screen" />
    <!--[if lt IE 9]>
        <link rel="stylesheet" type="text/css" href="cards-ie.css" media="screen" />
    <![endif]-->
    <!--[if IE 9]>
        <link rel="stylesheet" type="text/css" href="cards-ie9.css" media="screen" />
    <![endif]-->
    <!-- the following js and css is not part of the CSS cards, but only for this example page -->
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>
    <script type="text/javascript"><!--
    $(document).ready(function(){
        $('.options').addClass('active');
        $('.toggle li').click(function(){
            $('.playingCards').toggleClass($(this).text());
        });
        $('.lang li').click(function(){
            $('html').attr('lang', $(this).text());
            $('html').attr('xml:lang', $(this).text());
        });
    });
    //--></script>

    <link rel="stylesheet" href="./js/jquery-ui-1.10.3/themes/smoothness/jquery-ui.css" />
    <script src="./js/jquery-ui-1.10.3/jquery-1.9.1.js"></script>
    <script src="./js/jquery-ui-1.10.3/ui/jquery-ui.js"></script>

    <style type="text/css"><!--
        body {
            margin: 2em 20%;
            background-color: #088A4B;
        }

        .options.active {
            position: fixed;
            top: 1em;
            right: 1em;
            background: #ddd;
            padding: .5em;
        }
        .options.active h3 {
            font-size: 1.2em;
        }
        .options.active ul {
            padding: 0;
        }
        .options.active li {
            color: #00c;
            text-decoration: underline;
            margin-left: 1.5em;
            cursor: pointer;
        }
        .options.active li:hover {
            text-decoration: none;
        }
        div.clear {
            clear: both;
            height: 0;
            line-height: 0;
            font-size: 1px;
            visibility: hidden;
        }

        .wrapper {
            margin: 30px;
            width: 550px;
            height: 450px;
            position: absolute;
        }

        #player1Score {
            position: absolute;
            left: -250px;
            bottom: 110px;
        }

        #player2Score {
            position: absolute;
            right: 140px;
            bottom: 110px;
        } 

    --></style>
</head>
<body>

<div class="wrapper">

    <button id=player1Score>player 1 score: 0</button>
    <button id=player2Score>player 2 score: 0</button>    

    <div class="playingCards twoColours rotateHand">
        <ul class="deck">
            <li>
                <div class="card back">*</div>
            </li>
            <li>
                <div class="card back">*</div>
            </li>
            <li>
                <div class="card back">*</div>
            </li>
            <li>
                <div class="card back">*</div>
            </li>
            <li>
                <div class="card back">*</div>
            </li>
            <li>
                <div class="card back">*</div>
            </li>
            <li>
                <div class="card back">*</div>
            </li>
            <li>
                <div class="card back">*</div>
            </li>
            <li>
                <div class="card back">*</div>
            </li>
            <li>
                <div class="card back">*</div>
            </li>
            <li>
                <div class="card back">*</div>
            </li>
            <li>
                <div class="card back">*</div>
            </li>
            <li>
                <div class="card back">*</div>
            </li>
            <li>
                <div class="card back">*</div>
            </li>
            <li>
                <div class="card back">*</div>
            </li>
            <li>
                <div class="card back">*</div>
            </li>
            <li>
                <div class="card back">*</div>
            </li>
            <li>
                <div class="card back">*</div>
            </li>
            <li>
                <div class="card back">*</div>
            </li>
            <li>
                <div class="card back">*</div>
            </li>
        </ul>

        <div class=allcards>
            <div class="card rank-2 diams"><span class="rank">2</span><span class="suit">&diams;</span></div>
            <div class="card rank-3 diams"><span class="rank">3</span><span class="suit">&diams;</span></div>
            <div class="card rank-4 diams"><span class="rank">4</span><span class="suit">&diams;</span></div>
            <div class="card rank-5 diams"><span class="rank">5</span><span class="suit">&diams;</span></div>
            <div class="card rank-6 diams"><span class="rank">6</span><span class="suit">&diams;</span></div>
            <div class="card rank-7 diams"><span class="rank">7</span><span class="suit">&diams;</span></div>
            <div class="card rank-8 diams"><span class="rank">8</span><span class="suit">&diams;</span></div>
            <div class="card rank-9 diams"><span class="rank">9</span><span class="suit">&diams;</span></div>
            <div class="card rank-10 diams"><span class="rank">10</span><span class="suit">&diams;</span></div>
            <div class="card rank-j diams"><span class="rank">J</span><span class="suit">&diams;</span></div>
            <div class="card rank-q diams"><span class="rank">Q</span><span class="suit">&diams;</span></div>
            <div class="card rank-k diams"><span class="rank">K</span><span class="suit">&diams;</span></div>
            <div class="card rank-a diams"><span class="rank">A</span><span class="suit">&diams;</span></div>
            <div class="card rank-2 hearts"><span class="rank">2</span><span class="suit">&hearts;</span></div>
            <div class="card rank-3 hearts"><span class="rank">3</span><span class="suit">&hearts;</span></div>
            <div class="card rank-4 hearts"><span class="rank">4</span><span class="suit">&hearts;</span></div>
            <div class="card rank-5 hearts"><span class="rank">5</span><span class="suit">&hearts;</span></div>
            <div class="card rank-6 hearts"><span class="rank">6</span><span class="suit">&hearts;</span></div>
            <div class="card rank-7 hearts"><span class="rank">7</span><span class="suit">&hearts;</span></div>
            <div class="card rank-8 hearts"><span class="rank">8</span><span class="suit">&hearts;</span></div>
            <div class="card rank-9 hearts"><span class="rank">9</span><span class="suit">&hearts;</span></div>
            <div class="card rank-10 hearts"><span class="rank">10</span><span class="suit">&hearts;</span></div>
            <div class="card rank-j hearts"><span class="rank">J</span><span class="suit">&hearts;</span></div>
            <div class="card rank-q hearts"><span class="rank">Q</span><span class="suit">&hearts;</span></div>
            <div class="card rank-k hearts"><span class="rank">K</span><span class="suit">&hearts;</span></div>
            <div class="card rank-a hearts"><span class="rank">A</span><span class="suit">&hearts;</span></div>
            <div class="card rank-2 spades"><span class="rank">2</span><span class="suit">&spades;</span></div>
            <div class="card rank-3 spades"><span class="rank">3</span><span class="suit">&spades;</span></div>
            <div class="card rank-4 spades"><span class="rank">4</span><span class="suit">&spades;</span></div>
            <div class="card rank-5 spades"><span class="rank">5</span><span class="suit">&spades;</span></div>
            <div class="card rank-6 spades"><span class="rank">6</span><span class="suit">&spades;</span></div>
            <div class="card rank-7 spades"><span class="rank">7</span><span class="suit">&spades;</span></div>
            <div class="card rank-8 spades"><span class="rank">8</span><span class="suit">&spades;</span></div>
            <div class="card rank-9 spades"><span class="rank">9</span><span class="suit">&spades;</span></div>
            <div class="card rank-10 spades"><span class="rank">10</span><span class="suit">&spades;</span></div>
            <div class="card rank-j spades"><span class="rank">J</span><span class="suit">&spades;</span></div>
            <div class="card rank-q spades"><span class="rank">Q</span><span class="suit">&spades;</span></div>
            <div class="card rank-k spades"><span class="rank">K</span><span class="suit">&spades;</span></div>
            <div class="card rank-a spades"><span class="rank">A</span><span class="suit">&spades;</span></div>
            <div class="card rank-2 clubs"><span class="rank">2</span><span class="suit">&clubs;</span></div>
            <div class="card rank-3 clubs"><span class="rank">3</span><span class="suit">&clubs;</span></div>
            <div class="card rank-4 clubs"><span class="rank">4</span><span class="suit">&clubs;</span></div>
            <div class="card rank-5 clubs"><span class="rank">5</span><span class="suit">&clubs;</span></div>
            <div class="card rank-6 clubs"><span class="rank">6</span><span class="suit">&clubs;</span></div>
            <div class="card rank-7 clubs"><span class="rank">7</span><span class="suit">&clubs;</span></div>
            <div class="card rank-8 clubs"><span class="rank">8</span><span class="suit">&clubs;</span></div>
            <div class="card rank-9 clubs"><span class="rank">9</span><span class="suit">&clubs;</span></div>
            <div class="card rank-10 clubs"><span class="rank">10</span><span class="suit">&clubs;</span></div>
            <div class="card rank-j clubs"><span class="rank">J</span><span class="suit">&clubs;</span></div>
            <div class="card rank-q clubs"><span class="rank">Q</span><span class="suit">&clubs;</span></div>
            <div class="card rank-k clubs"><span class="rank">K</span><span class="suit">&clubs;</span></div>
            <div class="card rank-a clubs"><span class="rank">A</span><span class="suit">&clubs;</span></div>
        </div>

        <div class="clear"></div>

    </div>

</div>

    <script>
    var deck = [];
    var curInPlay = {};

    var gruid = 0;

    function idify(el) {
        if( !el.attr('id') ) {
            el.attr( 'id', 'gruid_' + gruid );
            gruid++;        
        }
    }

    function countScoreInPlay() {
        var score = 0;

        for( var c in curInPlay ) score++;

        return score;
    }

    function removeCardInPlay(el) {

        if( curInPlay[el.attr('id')] ) {
            delete curInPlay[el.attr('id')];
        }
    }

    function addCardInPlay( card ) {
        curInPlay[card.attr('id')] = card;
    }   

    var playerscore = [];
    playerscore.push(0);
    playerscore.push(0);

    function scoreCardsInPlay( playerNum ) {
        
        var where = (playerNum == 0) ? {
            left:  + $("#player1Score").position().left + 'px',
            top:  + ($("#player1Score").position().top+30) + 'px'
        } : {
            left: $("#player2Score").position().left +'px',
            top:  + ($("#player2Score").position().top+30) + 'px'
        };

        var options = { duration: 100 };

        for( var c in curInPlay ) {        
            $('#'+c).animate(where, options);
            playerscore[playerNum]++;
        }

        curInPlay = {};
    }

    function splitDeckAnimation( cardstack, index ) {

        var where = (index % 2) == 0 ? {left:'250px'} : {left:'-250px'};

        var options = { duration: 100 };

        if( index > 0 ) {

            options['complete'] = function() {
                splitDeckAnimation(cardstack, index-1); 
            };
        }

        $(cardstack[index]).animate(
            where, options
        );
    }

    function shuffle(o){ //v1.0
        for(var j, x, i = o.length; i; j = Math.floor(Math.random() * i), x = o[--i], o[i] = o[j], o[j] = x);
        return o;
    };

    var allcards = $( ".allcards .card" ).each( function(idx, val) {
        var card = $(val);

        card.draggable({ snap: true });
        card.hide();
        deck.push({
            rank : card.children()[0].innerText,
            suit : card.children()[1].innerText,
            element: card
        });
    });

    deck = shuffle(deck);
    var zedIndex = 10000;

    $(".deck").click( function() {
        var cardBacks = $(".deck li div");
        splitDeckAnimation( cardBacks, cardBacks.length-1 );

        $("div.card.back").click( function(evt) {
            if( evt.isPropagationStopped() ) return;
            evt.stopPropagation();

            var newCard = $('<div class="new card back">*</div>');
            var daddyCard = $(evt.toElement);
            
            //daddyCard.parent().append(newCard);
            
            newCard.css( 'position', 'absolute' );
            newCard.css( 'z-index', zedIndex++ );
            newCard.css( 'top', (daddyCard.position().top+10)  + "px" );
            newCard.css( 'left',(daddyCard.position().left+30) + "px" );            
            newCard.draggable();

            newCard.dblclick( function(evt) {

                if( evt.isPropagationStopped() ) return;
                evt.stopPropagation();

                var daddyCard = $(evt.toElement);

                var card = deck.pop();
                var babyCard = card.element;
                babyCard.css( 'position', 'absolute' );
                babyCard.css( 'z-index', zedIndex++ );
                babyCard.css( 'top', (daddyCard.position().top)  + "px" );
                babyCard.css( 'left',daddyCard.position().left + "px" );
                idify( babyCard );

                //card.element.position( $(evt.toElement).position() );
                babyCard.show();
                daddyCard.hide();

                removeCardInPlay( daddyCard );
                addCardInPlay( babyCard );
            } );      

            idify(newCard);
            $(".playingCards").append(newCard);

            addCardInPlay( newCard );
        } );
    } );

    $("#player1Score").click( function() {
        scoreCardsInPlay(0);
        $("#player1Score").html( "player 1 score: " + playerscore[0] );
    } );    

    $("#player2Score").click( function() {
        scoreCardsInPlay(1);
        $("#player2Score").html( "player 2 score: " +playerscore[1] );
    } );    

    </script>


</body>
</html>
